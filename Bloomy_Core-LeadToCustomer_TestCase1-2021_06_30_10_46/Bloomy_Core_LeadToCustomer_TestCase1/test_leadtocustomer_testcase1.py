from addons.random_data_generator import RandomDataGenerator
from addons.string_utils import StringUtils
from distutils.util import strtobool
from selenium.webdriver.common.by import By
from selenium.webdriver.support.select import Select
from src.testproject.classes import DriverStepSettings, StepSettings
from src.testproject.decorator import report_assertion_errors
from src.testproject.enums import SleepTimingType
from src.testproject.sdk.drivers import webdriver
from subtests import test_login
from subtests import test_logout
import pytest


"""
This pytest test was automatically generated by TestProject
    Project: Bloomy_Core
    Package: TestProject.Generated.Tests.BloomyCore
    Test: LeadToCustomer_TestCase1
    Generated by: Meenal Kardale (meenal.kardale@extrapreneurs-india.com)
    Generated on 06/30/2021, 10:46:15
"""


@pytest.fixture()
def driver():
    driver = webdriver.Chrome(token="3J0RNM_48lLt_KM5Ab6s6A_HZzddmktVs_HhX77AjTM",
                              project_name="Bloomy_Core",
                              job_name="LeadToCustomer_TestCase1")
    step_settings = StepSettings(timeout=15000,
                                 sleep_time=500,
                                 sleep_timing_type=SleepTimingType.Before)
    with DriverStepSettings(driver, step_settings):
        yield driver
    driver.quit()


@report_assertion_errors
def test_main(driver):
    """1. Go to the lead doctype.(Desk>> CRM>>Lead) or Type \"Lead in search bar\"\".

     2. Open Lead. 3. Click on create Button in top right corner and select customer.  It will redirect you to on Customer doctype. 4. Full name, from Lead will be fetch from Lead doctype. address and contact will be fetch from Lead doctype 5. Select customer Group. 6 Select Customer type ( Individual, Company, corporation,LLC). 7. Select Territory 8. Select License. 9. Save.
    """
    # Test Parameters
    # Auto generated application URL parameter
    ApplicationURL = "https://epitest-demo.bloomstack.io/"
    ExpectedLeadNm = ""
    ActualLeadNm = ""
    ExpectedLeadID = ""
    ActualLeadNamInCustomerPage = ""
    ActualLeadIDonCustomerPage = ""
    username = ""
    pwd = ""
    ActualFullNameonCustomerPage = ""
    RandomLeadNm = ""

    # 1. Navigate to '{ApplicationURL}'
    # Navigates the specified URL (Auto-generated)
    driver.get(f'{ApplicationURL}')

    # 2. Login to the Application
    test_login.test_main(driver)

    # 3. Click 'Search or type a command (Ctrl + G)'
    search_or_type_a_command_ctrl_g_ = driver.find_element(By.CSS_SELECTOR,
                                                           "#navbar-search")
    search_or_type_a_command_ctrl_g_.click()

    # 4. Type 'lead l' in 'Search or type a command (Ctrl + G)'
    search_or_type_a_command_ctrl_g_ = driver.find_element(By.CSS_SELECTOR,
                                                           "#navbar-search")
    search_or_type_a_command_ctrl_g_.send_keys("lead l")

    # 5. Click 'Lead List2'
    lead_list2 = driver.find_element(By.XPATH,
                                     "//p[. = 'Lead List']")
    lead_list2.click()

    # 6. Does 'Lead7' contain 'Lead'?
    lead7 = driver.find_element(By.XPATH,
                                "//div[. = 'Lead']")
    step_output = lead7.text
    assert step_output and ("Lead" in step_output)

    # 7. Click 'New4'
    new4 = driver.find_element(By.XPATH,
                               "//button[. = 'New']")
    new4.click()

    # 8. Is 'New Lead 11' visible?
    new_lead_11 = driver.find_element(By.XPATH,
                                      "//div[. = 'New Lead 1']")
    assert new_lead_11.is_displayed()

    # 9. Does 'Not Saved' contain 'Not Saved'?
    not_saved = driver.find_element(By.XPATH,
                                    "//span/span[. = 'Not Saved']")
    step_output = not_saved.text
    assert step_output and ("Not Saved" in step_output)

    # 10. Click 'INPUT64'
    input64 = driver.find_element(By.XPATH,
                                  "//div[4]/div[2]/div[1]/form/div[2]//input")
    input64.click()

    # 11. Generate random name
    step_output = driver.addons().execute(
        RandomDataGenerator.generatename(
        ))
    RandomLeadNm = step_output

    # 12. Type '{RandomLeadNm}' in 'INPUT64'
    input64 = driver.find_element(By.XPATH,
                                  "//div[4]/div[2]/div[1]/form/div[2]//input")
    input64.send_keys(f'{RandomLeadNm}')

    # 13. Get text from 'INPUT64'
    input64 = driver.find_element(By.XPATH,
                                  "//div[4]/div[2]/div[1]/form/div[2]//input")
    step_output = input64.get_attribute("value")
    ExpectedLeadNm = step_output

    # 14. Click 'INPUT67'
    input67 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[1]//input")
    input67.click()

    # 15. Type 'Address Title' in 'INPUT67'
    input67 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[1]//input")
    input67.send_keys("Address Title")

    # 16. Click 'INPUT68'
    input68 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[2]//input")
    input68.click()

    # 17. Type 'Add1' in 'INPUT68'
    input68 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[2]//input")
    input68.send_keys("Add1")

    # 18. Click 'INPUT69'
    input69 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[3]//input")
    input69.click()

    # 19. Type 'Add2' in 'INPUT69'
    input69 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[3]//input")
    input69.send_keys("Add2")

    # 20. Click 'INPUT70'
    input70 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[4]//input")
    input70.click()

    # 21. Type 'mumbai' in 'INPUT70'
    input70 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[4]//input")
    input70.send_keys("mumbai")

    # 22. Click 'INPUT71'
    input71 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[5]//input")
    input71.click()

    # 23. Type 'india' in 'INPUT71'
    input71 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[1]/form/div[5]//input")
    input71.send_keys("india")

    # 24. Click 'INPUT72'
    input72 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[2]/form/div[1]//input")
    input72.click()

    # 25. Type 'maharastra' in 'INPUT72'
    input72 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[2]/form/div[1]//input")
    input72.send_keys("maharastra")

    # 26. Click 'INPUT73'
    input73 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[2]/form/div[2]//input")
    input73.click()

    # 27. Clear 'inputtext1' contents
    inputtext1 = driver.find_element(By.XPATH,
                                     "//div[7]/div[2]/div[2]/form/div[2]//input")
    inputtext1.clear()

    # 28. Type 'indi' in 'INPUT73'
    input73 = driver.find_element(By.XPATH,
                                  "//div[7]/div[2]/div[2]/form/div[2]//input")
    input73.send_keys("indi")

    # 29. Click 'India'
    india = driver.find_element(By.XPATH,
                                "//li[. = 'India']")
    india.click()

    # 30. Click 'INPUT74'
    input74 = driver.find_element(By.XPATH,
                                  "//div[2]/form/div[3]/div/div[2]/div/input")
    input74.click()

    # 31. Type '40066' in 'INPUT74'
    input74 = driver.find_element(By.XPATH,
                                  "//div[2]/form/div[3]/div/div[2]/div/input")
    input74.send_keys("40066")

    # 32. Click 'INPUT75'
    input75 = driver.find_element(By.XPATH,
                                  "//div[8]/div[2]/div/form/div[1]//input")
    input75.click()

    # 33. Type '1111777765' in 'INPUT75'
    input75 = driver.find_element(By.XPATH,
                                  "//div[8]/div[2]/div/form/div[1]//input")
    input75.send_keys("1111777765")

    # 34. Click 'INPUT76'
    input76 = driver.find_element(By.XPATH,
                                  "//div[8]/div[2]/div/form/div[2]//input")
    input76.click()

    # 35. Type '9876098765' in 'INPUT76'
    input76 = driver.find_element(By.XPATH,
                                  "//div[8]/div[2]/div/form/div[2]//input")
    input76.send_keys("9876098765")

    # 36. Click 'INPUT77'
    input77 = driver.find_element(By.XPATH,
                                  "//div[8]/div[2]/div/form/div[3]//input")
    input77.click()

    # 37. Type '445577' in 'INPUT77'
    input77 = driver.find_element(By.XPATH,
                                  "//div[8]/div[2]/div/form/div[3]//input")
    input77.send_keys("445577")

    # 38. Click 'Save123'
    save123 = driver.find_element(By.XPATH,
                                  "//button[. = 'Save']")
    save123.click()

    '''
    # (STEP DISABLED)
    # 39. Click 'savebu'
    savebu = driver.find_element(By.XPATH,
    "//button[. = 'Save']")
    savebu.click()
    '''

    # 40. Get text from 'Test67'
    test67 = driver.find_element(By.XPATH,
                                 "//h1//div[. = 'Test67']")
    step_output = test67.get_attribute("value")
    ActualLeadNm = step_output

    # 41. Does 'Lead8' contain 'Lead'?
    lead8 = driver.find_element(By.XPATH,
                                "//span/span[. = 'Lead']")
    step_output = lead8.text
    assert step_output and ("Lead" in step_output)

    # 42. Get text from 'CRM-LEAD-2021-00367'
    crm_lead_2021_00367 = driver.find_element(By.XPATH,
                                              "//h6[. = 'CRM-LEAD-2021-00367']")
    step_output = crm_lead_2021_00367.get_attribute("value")
    ExpectedLeadID = step_output

    # 43. Click 'Create'
    create = driver.find_element(By.XPATH,
                                 "//button[. = '\t\t\t\tCreate ']")
    create.click()

    # 44. Click 'Customer1'
    customer1 = driver.find_element(By.XPATH,
                                    "//div[2]/div[1]/div[1]/div/ul//a[. = 'Customer']")
    customer1.click()

    # 45. Get text from 'Test671'
    test671 = driver.find_element(By.XPATH,
                                  "//div[4]/div[1]//div[. = 'Test67']")
    step_output = test671.get_attribute("value")
    ActualLeadNamInCustomerPage = step_output

    # 46. Does 'Enabled1' contain 'Enabled'?
    enabled1 = driver.find_element(By.XPATH,
                                   "//span/span[. = 'Enabled']")
    step_output = enabled1.text
    assert step_output and ("Enabled" in step_output)

    # 47. Click 'INPUT93'
    input93 = driver.find_element(By.XPATH,
                                  "//div[3]/div[2]/div[1]/form/div[3]//input")
    input93.click()

    # 48. Get text from 'GetFullName'
    getfullname = driver.find_element(By.XPATH,
                                      "//div[3]/div[2]/div[1]/form/div[3]//input")
    step_output = getfullname.get_attribute("value")
    ActualFullNameonCustomerPage = step_output

    # 49. Click 'INPUT94'
    input94 = driver.find_element(By.XPATH,
                                  "//div[4]/div[2]/div[2]/div/div[3]/div[2]/div[1]/div[3]/div/div/div[2]/div[3]/div[2]/div[2]/form/div[2]//input")
    input94.click()

    # 50. Clear 'CustGrp' contents
    custgrp = driver.find_element(By.XPATH,
                                  "//div[4]/div[2]/div[2]/div/div[3]/div[2]/div[1]/div[3]/div/div/div[2]/div[3]/div[2]/div[2]/form/div[2]//input")
    custgrp.clear()

    # 51. Click 'Clickoncustgrp'
    clickoncustgrp = driver.find_element(By.XPATH,
                                         "//div[4]/div[2]/div[2]/div/div[3]/div[2]/div[1]/div[3]/div/div/div[2]/div[3]/div[2]/div[2]/form/div[2]//input")
    clickoncustgrp.click()

    # 52. Click 'CustGrpValue'
    custgrpvalue = driver.find_element(By.XPATH,
                                       "//strong[. = 'Profitable']")
    custgrpvalue.click()

    # 53. Click 'SELECT12'
    select12 = driver.find_element(By.XPATH,
                                   "//div[5]//select")
    select12.click()

    # 54. Select the 'Corporation' option in 'select56'
    select56 = driver.find_element(By.XPATH,
                                   "//div[5]//select")
    Select(select56).select_by_value("Corporation")

    # 55. Click 'SELECT12'
    select12 = driver.find_element(By.XPATH,
                                   "//div[5]//select")
    select12.click()

    # 56. Click 'INPUT95'
    input95 = driver.find_element(By.XPATH,
                                  "//div[3]/div[2]/div[2]/form/div[3]//input")
    input95.click()

    # 57. Clear 'clearinput95' contents
    clearinput95 = driver.find_element(By.XPATH,
                                       "//div[3]/div[2]/div[2]/form/div[3]//input")
    clearinput95.clear()

    # 58. Click 'clickinput95'
    clickinput95 = driver.find_element(By.XPATH,
                                       "//div[3]/div[2]/div[2]/form/div[3]//input")
    clickinput95.click()

    # 59. Click 'LI9'
    li9 = driver.find_element(By.XPATH,
                              "//div[3]/div/div[2]/div[1]/div/div/ul/li[1]")
    li9.click()

    # 60. Get text from 'INPUT96'
    input96 = driver.find_element(By.XPATH,
                                  "//div[9]/div/div[2]/div//input")
    step_output = input96.get_attribute("value")
    ActualLeadIDonCustomerPage = step_output

    # 61. Click 'Add Row7'
    add_row7 = driver.find_element(By.XPATH,
                                   "//div[6]//button[. = '\n\t\t\t\t\t\t\tAdd Row']")
    add_row7.click()

    # 62. Click 'DIV31'
    div31 = driver.find_element(By.XPATH,
                                "//form/div/div/div[2]/div[2]/div[1]/div/div/div[2]")
    div31.click()

    # 63. Type '[NONE]' in 'License'
    license = driver.find_element(By.XPATH,
                                  "//input[@placeholder = 'License']")
    license.send_keys(" ")

    # 64. Click 'LI10'
    li10 = driver.find_element(By.XPATH,
                               "//div[2]/div[1]/div/div/div[2]/div[1]/div//li[1]")
    li10.click()

    # 65. Does 'Not Saved1' contain 'Not Saved'?
    not_saved1 = driver.find_element(By.XPATH,
                                     "//span/span[. = 'Not Saved']")
    step_output = not_saved1.text
    assert step_output and ("Not Saved" in step_output)

    # 66. Compares '{ExpectedLeadNm}' with '{ActualLeadNm}'
    step_output = driver.addons().execute(
        StringUtils.comparetwostrings(
            firstString=f'{ExpectedLeadNm}',
            secondString=f'{ActualLeadNm}',
            ignoreCase=False,
            expectedResult=0))

    # 67. Compares '{ExpectedLeadNm}' with '{ActualLeadNamInCustomerPage}'
    step_output = driver.addons().execute(
        StringUtils.comparetwostrings(
            firstString=f'{ExpectedLeadNm}',
            secondString=f'{ActualLeadNamInCustomerPage}',
            ignoreCase=False,
            expectedResult=0))

    # 68. Compares '{ExpectedLeadNm}' with '{ActualFullNameonCustomerPage}'
    step_output = driver.addons().execute(
        StringUtils.comparetwostrings(
            firstString=f'{ExpectedLeadNm}',
            secondString=f'{ActualFullNameonCustomerPage}',
            ignoreCase=False,
            expectedResult=0))

    # 69. Compares '{ExpectedLeadID}' with '{ActualLeadIDonCustomerPage}'
    step_output = driver.addons().execute(
        StringUtils.comparetwostrings(
            firstString=f'{ExpectedLeadID}',
            secondString=f'{ActualLeadIDonCustomerPage}',
            ignoreCase=False,
            expectedResult=0))

    # 70. Click 'Save19'
    save19 = driver.find_element(By.XPATH,
                                 "//div[4]//button[. = 'Save']")
    save19.click()

    # 71. Does 'Enabled1' contain 'Enabled'?
    enabled1 = driver.find_element(By.XPATH,
                                   "//span/span[. = 'Enabled']")
    step_output = enabled1.text
    assert step_output and ("Enabled" in step_output)

    # 72. Click 'Save22'
    save22 = driver.find_element(By.XPATH,
                                 "//div[4]//span[. = 'Save']")
    save22.click()

    # 73. Is 'Saved2' present?
    saved2 = driver.find_element(By.XPATH,
                                 "//div[5]/div[. = 'Saved']")

    # 74. Logout from the application
    test_logout.test_main(driver)

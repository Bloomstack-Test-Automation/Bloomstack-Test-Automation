from addons.random_data_generator import RandomDataGenerator
from selenium.webdriver.common.by import By
from src.testproject.classes import DriverStepSettings, StepSettings
from src.testproject.decorator import report_assertion_errors
from src.testproject.enums import SleepTimingType
from src.testproject.sdk.drivers import webdriver
from subtests import test_logintest
from subtests import test_logouttest
import pytest


"""
This pytest test was automatically generated by TestProject
    Project: Bloomy_Core
    Package: TestProject.Generated.Tests.BloomyCore
    Test: TestCase_RandomDataGenaration
    Generated by: Meenal Kardale (meenal.kardale@extrapreneurs-india.com)
    Generated on 05/18/2021, 12:51:21
"""


@pytest.fixture()
def driver():
    driver = webdriver.Chrome(token="3J0RNM_48lLt_KM5Ab6s6A_HZzddmktVs_HhX77AjTM",
                              project_name="Bloomy_Core",
                              job_name="TestCase_RandomDataGenaration")
    step_settings = StepSettings(timeout=15000,
                                 sleep_time=500,
                                 sleep_timing_type=SleepTimingType.Before)
    with DriverStepSettings(driver, step_settings):
        yield driver
    driver.quit()


@report_assertion_errors
def test_main(driver):
    """If some field value is already exist then it will create random data at runtime."""
    # Test Parameters
    # Auto generated application URL parameter
    ApplicationURL = "https://epitest-demo.bloomstack.io/"
    Suppliername = ""

    # 1. Run LoginTest
    test_logintest.test_main(driver)

    # 2. Is 'Getting Started' visible?
    getting_started = driver.find_element(By.XPATH,
                                          "//div[. = '\n                Getting Started\n              ']")
    assert getting_started.is_displayed()

    # 3. Click 'Getting Started'
    getting_started = driver.find_element(By.XPATH,
                                          "//div[. = '\n                Getting Started\n              ']")
    getting_started.click()

    # 4. Is 'Getting Started1' visible?
    getting_started1 = driver.find_element(By.XPATH,
                                           "//div[. = 'Getting Started']")
    assert getting_started1.is_displayed()

    # 5. Is 'Supplier' is clickable?
    supplier = driver.find_element(By.XPATH,
                                   "//div/a[. = 'Supplier']")
    assert supplier.is_enabled()

    # 6. Click 'Supplier'
    supplier = driver.find_element(By.XPATH,
                                   "//div/a[. = 'Supplier']")
    supplier.click()

    # 7. Click 'New'
    new = driver.find_element(By.XPATH,
                              "//button[. = 'New']")
    new.click()

    # 8. Generate random string
    step_output = driver.addons().execute(
        RandomDataGenerator.generatestring(
        ))
    Suppliername = step_output

    # 9. Type '{Suppliername}' in 'INPUT1'
    input1 = driver.find_element(By.XPATH,
                                 "//form/div[1]/div/div//input")
    input1.send_keys(f'{Suppliername}')

    # 10. Click 'INPUT2'
    input2 = driver.find_element(By.XPATH,
                                 "//div[2]/div/div[2]/div[1]/div/div/input")
    input2.click()

    # 11. Click 'Electrical'
    electrical = driver.find_element(By.XPATH,
                                     "//p[. = 'Electrical']")
    electrical.click()

    # 12. Click 'Save2'
    save2 = driver.find_element(By.XPATH,
                                "//button[. = 'Save']")
    save2.click()

    # 13. Run LogoutTest
    test_logouttest.test_main(driver)

    # 14. Is 'Login' visible?
    login = driver.find_element(By.XPATH,
                                "//a[. = 'Login']")
    assert login.is_displayed()
